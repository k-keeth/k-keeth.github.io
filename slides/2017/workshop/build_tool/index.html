<html>
  <head>
    <meta charset="utf-8">
    <title>自動ビルドしながらの開発</title>
    <link rel="stylesheet" href="../../../talkiejs/talkie.min.css">
    <link rel="stylesheet" href="../../../talkiejs/talkie-default.min.css">
    <link rel="stylesheet" href="../../../talkiejs/style.css">
    <link rel="shortcut icon" href="../../../assets/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai.min.css">
    <script src="../../../talkiejs/highlight.min.js"></script>
  </head>
  <body>
<template layout="cover" type="text/x-markdown">
# 自動ビルドしながらの開発
### 2017/05/26　@レプラホーン本社
</template>

<template layout="cover" type="text/x-markdown">
## 自己紹介

```
var my_info = {
    name:   '桑原聖仁',
    twitter: '@kuwahara_ngv2（たまに変わります）',
    github: 'k-kuwahara',
    qiita:    '@clown0082',
    skill: 'PHP, CodeIgniter, JavaScript, Riot.js, Angular',
    workplace:  'Leprachaun Corp.'
}
```
</template>

<section layout="bullets" type="text/x-markdown">
## 今回のアジェンダ
- ビルドツールの紹介
- Gulpを使ってみよう
- Webpackを使ってみよう
</section>

<section layout="bullets" type="text/x-markdown">
## 今回のアジェンダ
- <span class="assert">ビルドツールの紹介</span>  <= まずはココ
- Gulpを使ってみよう
- Webpackを使ってみよう
</section>

<section layout="title-invert" type="text/x-markdown">
## 最近のJavaScript開発環境

「モダン開発環境」という言葉をいたるところで耳にする昨今ですが、「つまりどんな環境なの？」と思いますよね。
一言で言うと、<span class="assert">「面倒な作業は自動化して楽しよう」</span>という環境、と私は考えています。

</section>

<section layout="title-invert" type="text/x-markdown">
## 「面倒な作業」って？
</section>

<section layout="bullets" type="text/x-markdown">
## こんなやつです。

- ES6, TypeScriptのコンパイル
- テンプレートエンジンを用いたファイルのコンパイル
- PostCSS, LESS, Sassなどのプリプロセッサーのコンパイル
- ESLint, JSLint, JSHintなどのリンターのチェック
- js, cssの圧縮（minify）、ファイルのリネーム
- 画像ファイルの圧縮
- バンドル
</section>

<section layout="title-invert" type="text/x-markdown">
## これらを自動でやってくれる<br>素晴らしいツールが<br>世の中にはあります( ﾟ∀ﾟ)
</section>

<section layout="bullets" type="text/x-markdown">
## こやつらです。

|__タスクランナー__|__評価__|__バンドラ__|__評価__|
|:--:|:--:|:--:|:--:|
|Grant|D|Webpack|A|
|Gulp|B|Rollup|C|

※評価は私の独断と偏見に基づきます（笑）
</section>

<section layout="bullets" type="text/x-markdown">
## 今回触れるのはこの子ら。

|__タスクランナー__|__評価__|__バンドラ__|__評価__|
|:--:|:--:|:--:|:--:|
|Grant|D|<span class="assert f38">Webpack</span>|A|
|<span class="assert f38">Gulp</span>|B|Rollup|C|

</section>

<section layout="bullets" type="text/x-markdown">
## 今回のアジェンダ
- ビルドツールの紹介</span>
- <span class="assert">Gulpを使ってみよう</span>  <= 次はココ
- Webpackを使ってみよう
</section>

<section layout="cover" type="text/x-markdown">
## Gulp
### Automate and enhance your workflow

<img class="logo" src="./img/gulp-logo.png" width="120">

gulp is a toolkit for automating painful or time-consuming tasks in your development workflow, so you can stop messing around and build something.<br><span class="mright">（[公式サイト](http://gulpjs.com/)より）</span>
</section>

<section layout="title-invert" type="text/x-markdown">
## さっそく使ってみましょう！
</section>

<section layout="bullets" type="text/x-markdown">
## 今回は以下のタスクを自動化

1. ファイルの変更を検知する
1. jsファイルをESLintにかける
1. 問題なければ圧縮する
1. 圧縮したものを.minという名前で出力する
1. 上記実行中にエラーが起こってもgulpを止めない
</section>

<section layout="code" type="text/x-markdown">
## まずはGulpをインストール

```shell
$ npm i [--save|-D] gulp
```

※ `--save, -D`はオプションです。
</section>

<section layout="code" type="text/x-markdown">
## Gulpを動かすためにタスクを設定

### `gulpfile.js`というファイルを作成し、<br>次のコードを追記して下さい。
</section>

<section layout="code" type="text/x-markdown">
```JavaScript
const gulp = require('gulp')

// 'test'という名前のタスクを設定
gulp.task('test', function() {
   console.info('gulp run !!\n')
})
```
</section>

<section layout="code" type="text/x-markdown">
## Gulpのタスクを起動させるために<br>コマンドを設定

### `package.json`を開き、次のコードを追記して下さい。
</section>

<section layout="code" type="text/x-markdown">
```JSON
// package.jsonの中身抜粋
...
  "scripts": {
    "gulp": "gulp"
  },
...
```

</section>

<section layout="code" type="text/x-markdown">
## 準備完了です。以下の<br>コマンドを実行して下さい。

```shell
$ npm run gulp test
```

※ `test`は必須です！
</section>

<section layout="code" type="text/x-markdown">

```shell
// 実行結果例
[15:09:08] Starting 'test'...
gulp run !!

[15:09:08] Finished 'test' after 251 μs
```

</section>

<section layout="code" type="text/x-markdown">
## 動きましたが、`test`と、いちいちタスク名を入力するのは煩わしいですね。省略しましょう。

</section>

<section layout="code" type="text/x-markdown">
## `gulpfile.js`に以下を追記して下さい。
<br>

```JavaScript
// 末尾に追記
gulp.task('default', ['test'])
```
</section>

<section layout="code" type="text/x-markdown">
## 再度実行してみましょう。

```shell
$ npm run gulp
```
</section>

<section layout="code" type="text/x-markdown">
## 以上が、最小限のGulpの<br>動かし方です。

## それでは、今回のタスクに<br>入っていきます。
</section>

<section layout="bullets" type="text/x-markdown">
## 【再掲】今回のタスク

1. ファイルの変更を検知する
1. jsファイルをESLintにかける
1. 問題なければ圧縮する
1. 圧縮したものを.minという名前で出力する
1. 上記実行中にエラーが起こってもgulpを止めない
</section>

<section layout="code" type="text/x-markdown">
## 1. ファイルの変更を検知する
</section>

<section layout="code" type="text/x-markdown">
## `js`というディレクトリ内の<br>`.js`ファイルに変更がある度に<br>`test`タスクが実行されるように<br>設定してみましょう。
</section>

<section layout="code" type="text/x-markdown">
## ディレクトリの構成

```JavaScript
├ node_modules/
├ package.json
├ gulpfile.js
├ js/   ← 変更の検知対象
└ build/   ← ビルドの出力先
```

※ 今は`js`ディレクトリのみ作成して下さい。
</section>

<section layout="code" type="text/x-markdown">
## `js`ディレクトリに`(適当な名前).js`<br>ファイルを作成してください。
</section>

<section layout="code" type="text/x-markdown">
## 次に、ファイルに変更があることを検知する設定をします。
</section>

<section layout="code" type="text/x-markdown">
## `gulpfile.js`に以下を追記して下さい。
<br>

```JavaScript
// 適当な箇所に追記
gulp.task('watch', function() {
   gulp.watch('./js/*.js', ['test'])
})

gulp.task('default', ['watch'])
```
</section>

<section layout="code" type="text/x-markdown">
## `watch`タスクを実行しましょう。

```shell
$ npm run gulp
```

※`default`タスクに設定しているため`watch`は不要。
</section>

<section layout="code" type="text/x-markdown">
## これで準備完了です。<br>先程作成した`.js`ファイルを変更、<br>保存して下さい。
</section>

<section layout="code" type="text/x-markdown">
```shell
[17:12:19] Starting 'watch'...
[17:12:19] Finished 'watch' after 17 ms
[17:12:22] Starting 'test'...
gulp run !!

[17:12:22] Finished 'test' after 875 μs
[17:18:29] Starting 'test'...
gulp run !!

[17:18:29] Finished 'test' after 113 μs
```
</section>

<section layout="code" type="text/x-markdown">
## 以上でタスク1は終了です。
</section>

<section layout="bullets" type="text/x-markdown">
## 今回のアジェンダ
- ビルドツールの紹介</span>
- Gulpを使ってみよう
- <span class="assert">Webpackを使ってみよう</span>  <= 最後にココ
</section>

<section layout="cover" type="text/x-markdown">
## Webpack
### bundle your assets, scripts, images, styles

<img class="logo" src="./img/webpack-logo.png" width="120">

webpack is a module bundler. Its main purpose is to bundle JavaScript files for usage in a browser, yet it is also capable of transforming, bundling, or packaging just about any resource or asset.<br><span class="mright">（[公式リポジトリ](https://github.com/webpack/webpack)より）</span>
</section>

<section layout="code" type="text/x-markdown">
## `[-g|--save|--save-dev]`の意味は？
</section>


<section layout="code" type="text/x-markdown">
## `dependencies, devDependencies`という<br>2つの項目が追加されました。

</section>

<section layout="code" type="text/x-markdown">
### 今後モジュールをインストールすると、<br>package.jsonに`名前: バージョン`形式で<br>自動で追記されます。

<br>

※ `--save|--save-dev`がないと追記されませんので注意！
</section>

<section layout="code" type="text/x-markdown">
### `webpack`のアップデートを行ってみましょう！<br>以下のコマンドを実行して下さい。

```shell
$ npm up webpack
$ npm ls --depth=0
```
</section>

<section layout="code" type="text/x-markdown">
### 以下のように、webpackのバージョンが<br>更新されたと思います。

```node
├── gulp@3.9.1
└── webpack@1.14.0
```

</section>

<section layout="code" type="text/x-markdown">
### しかし、package.jsonは更新されません。

```JSON
...
  "devDependencies": {
    // 1.7.0のまま!!
    "webpack": "^1.7.0"
  },
...
```

</section>

<section layout="code" type="text/x-markdown">
### package.jsonも更新したい場合は、<br>インストールコマンドを実行して下さい。

```shell
$ npm i -D webpack
```

※ `-D`は`--save-dev`の省略形

</section>

<section layout="code" type="text/x-markdown">
### 今度はpackage.jsonが更新されたと思います♪

```JSON
...
  "devDependencies": {
    "webpack": "^1.14.0"
  },
...
```

</section>

<section layout="code" type="text/x-markdown">
### ここで`node_modules`ディレクトリを削除し、<br>以下のコマンドを実行してみてください。

```shell
$ npm i
$ npm ls --depth=0
```
</section>

<section layout="code" type="text/x-markdown">
### 以下のように、必要なモジュールが<br>全てインストールされたことが確認できます！

```node
├── gulp@3.9.1
└── webpack@1.14.0
```
</section>

<section layout="code" type="text/x-markdown">
### npmはinstallコマンドが実行されたとき、<br>自動でpackage.jsonを確認し、<br>（依存性も含めて）必要なモジュールを<br>一括でインストールしてくれます。

</section>

<section layout="code" type="text/x-markdown">
### この`package.json`を共有すれば、他のメンバーも同じ開発環境を作ることができます♪（便利だなー）

</section>

<section layout="cover" type="text/x-markdown">
# 以上で今回のワークショップは終了です！
</section>

<script layout="cover" type="text/x-markdown">
# 次回は<span class="assert">ES6(ES2015)</span>について触れます♪
</script>

<script layout="cover" type="text/x-markdown">
# 以上、お疲れ様でした！
</script>


  <script src="../../../talkiejs/talkie.min.js"></script>
  <script>
  var talkie = Talkie({wide: false});
  document.addEventListener('DOMContentLoaded', function() {
    var slides = Array.prototype.slice.call(document.querySelectorAll('[layout]'));
    // talkie.changed.onValue(function(current) {
    //   console.clear();
    //   // print presenter notes
    //   console.info(talkie.notes[current.getAttribute('page')]);
    // });
  });
  </script>
  </body>
</html>
