<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>フロントエンドのユニットテスト</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../../shower/themes/ribbon/styles/screen-16x10.css">
    <link rel="stylesheet" href="../../../assets/style.css">
    <link rel="shortcut icon" href="../../../assets/favicon.ico">
  </head>
  <body class="shower list">
    <header class="caption">
      <h1>フロントエンドのユニットテスト</h1>
      <p class="desc">
        Click：　スライドスタート<br>
        Enter：　次へ進む<br>
        →, ↓：　次へ進む<br>
        ←, ↑：　前へ戻る<br>
        ESC：　一覧へ戻る
      </p>
    </header>
    <section class="slide" id="cover">
      <h2>
        フロントエンドの<br>ユニットテスト
      </h2>
      <p>
        2017/06/23　@レプラホーン本社<br>
      </p>
    </section>

    <section class="slide">
      <h2>自己紹介</h2>
      <pre>
<code>var my_info = {
  <key>name</key>: <value>'Kiyohito Kuwahara'</value>,
  <key>twitter</key>: <value>'@kuwahara_ngv2'（たまに変わります）</value>,
  <key>github</key> : <value>'k-kuwahara'</value>,
  <key>qiita</key>  : <value>'@clown0082'</value>,
  <key>skill</key>  : <value>'PHP, CodeIgniter, JS, Riot, Angular'</value>,
  <key>workplace</key>: <value>'Leprachaun Corp.'</value>
}</code>
      </pre>
    </section>

    <section class="slide">
      <h2>アジェンダ</h2>
      <ol>
        <li>コンソールでのテスト</li>
        <li>フレームワーク（Mocha）の導入</li>
        <li>Node.jsで実行</li>
        <li>karmaの導入</li>
        <li>テストケースのバンドル</li>
      </ol>
      <p>※ 何かあれが随時聞いていただいて問題ありません。</p>
    </section>

    <section class="slide">
      <h2>今回使うサンプルアプリ</h2>
      よくあるログインフォームです。<br>
      こんなやつ→
      <p class="fright"><img src="img/demo.png"></p>
      <ul class="mt20">
        <li><a href="https://github.com/k-kuwahara/k-kuwahara.github.io/tree/master/slides/2017/workshop/unit_test/demo" target="_blank">ソース</a></li>
        <li><a href="https://github.com/k-kuwahara/k-kuwahara.github.io/raw/master/slides/2017/workshop/unit_test/demo/demo.zip" target="_blank">ダウンロード</a></li>
        <li><a href="https://k-kuwahara.github.io/slides/2017/workshop/unit_test/demo/" target="_blank">デモ</a></li>
      </ul>
      <style>
         img {
            border: 1px solid #ccc;
         }
      </style>
    </section>

    <section class="slide center-text">
      <h2 class="shout">軽くデモアプリの解説</h2>
    </section>

    <section class="slide center-text">
      <p class="f30"><span class="assert">index.html</span></p>
      <pre class="">
        <code>    &lt;p&gt;</code>
        <code>      ID: &lt;br&gt;&lt;input type="text" id="user"&gt;</code>
        <code>    &lt;p&gt;</code>
        <code>    &lt;/p&gt;</code>
        <code>      Password: &lt;br&gt;&lt;input type="password" id="pass"&gt;</code>
        <code>    &lt;/p&gt;</code>
        <code>    &lt;button id="send" type="button"&gt;Send&lt;/button&gt;</code>
        <code>  （続く）</code>
      </pre>
    </section>

    <section class="slide center-text">
      <p class="f30"><span class="assert">index.html</span></p>
      <pre class="">
        <code>    <comment>&lt;!-- ↓↓テスト対象のファイル --&gt;</comment></code>
        <code>    <mark>&lt;script src="src/util.js"&gt;&lt;/script&gt;</mark></code>
        <code>    &lt;script src="src/app.js"&gt;&lt;/script&gt;</code>
        <code>    <comment>&lt;!-- ↓↓テストケースのファイル --&gt;</comment></code>
        <code>    <mark>&lt;script src="src/util-spec.js"&gt;&lt;/script&gt;</mark></code>
      </pre>
    </section>

    <section class="slide center-text">
      <p class="f30"><span class="assert">app.js</span></p>
      <pre class="">
        <code>  $(<key>'#send'</key>).on(<key>'click'</key>, <value>function</value>() {</code>
        <code>     <error>var</error> user = $(<key>'#user'</key>).val(),</code>
        <code>         pass = $(<key>'#pass'</key>).val(),</code>
        <code>         <comment>// ↓↓テスト対象のメソッド</comment></code>
        <code>         <mark>key  = auth_check(user, pass)</mark></code>
        <code>     </code>
        <code>     $(<key>'#result'</key>).text(<value>get_message</value>(key))</code>
        <code>  }</code>
      </pre>
    </section>

    <section class="slide center-text">
      <p class="f30"><span class="assert">util.js</span></p>
      <pre class="">
        <code>  <comment>// 今回の説明のため正解を変数に保持</comment></code>
        <code>  <error>var</error> correct = <key>'test1234'</key></code>
        <code>  </code>
        <code>  <key>function</key> <value>auth_check</value>(user, pass) {</code>
        <code>     <error>var</error> key = ''</code>
        <code>     <error>if</error> (user == void 0 || pass == void 0)</code>
        <code>        <key>key</key> = <value>'required'</value></code>
        <code>  （続く）</code>
      </pre>
    </section>

    <section class="slide center-text">
      <p class="f30"><span class="assert">util.js</span></p>
      <pre class="">
        <code>     <error>else if</error> (user.length == 0 || pass.length == 0)</code>
        <code>        <key>key</key> = <value>'required'</value></code>
        <code>     <error>else if</error> (pass != correct)</code>
        <code>        <key>key</key> = <value>'unauthenticated'</value></code>
        <code>     <error>else if</error> (pass.length > 0 && pass === correct)</code>
        <code>        <key>key</key> = <value>'login'</value></code>
        <code>     <error>return</error> key</code>
        <code>  }</code>
      </pre>
    </section>

    <section class="slide center-text">
      <h2 class="shout">閑話休題</h2>
    </section>

    <section class="slide center-text">
      <h2 class="shout">1. コンソールでのテスト</h2>
    </section>

    <section class="slide center-text">
      <h3 class="">1. コンソールでのテスト</h3>
      <p class="f30">
        今回はindex.htmlにてutil-spec.jsファイルを読み込んでいるので、デモアプリを開いたタイミングでテストが実行されます。
      </p>
      <p class="f30">
        デモアプリ開いた後、F12から「console」を開いて下さい。
      </p>
    </section>

    <section class="slide center-text">
      <h3 class="">1. コンソールでのテスト</h3>
      <pre class="">
<code><value>auth_check関数のテスト</value>
<value>IDの文字数が0以上かつ、Passwordが'test1234'だったら正解</value>
==========
<value>case1: どちらも空のケース</value>
OK
<value>case2: どちらも空文字列のケース</value>
OK    （以下略）</code>
      </pre>
    </section>

    <section class="slide center-text">
      <h2 class="shout">2. フレームワーク（Mocha）<br>の導入</h2>
    </section>

    <section class="slide center-text">
      <h3 class="">2. フレームワーク（Mocha）の導入</h2>
      <p class="f30">console関数で地道にガリガリ書いてもいいですが、見辛いかつ、いちいちconsole開かないといけなく、色々不便です。</p>
      <p class="f30">これを解決するため、フレームワークを導入しましょう。<br>今回は<a href="https://mochajs.org/" target="_blank">Mocha</a>を使います。</p>
    </section>

    <section class="slide center-text">
      <h3 class="">2. フレームワーク（Mocha）の導入</h2>
      <p class="f30">導入手順は以下です。</p>
      <ol>
        <li class="next">CDN等で<mark>mocha.js, mocha.css</mark>を取得</li>
        <li class="next"><mark>&lt;div id="mocha"&gt;&lt;/div&gt;</mark>を設置</li>
        <li class="next">テストケースの読み込み前に<mark>mocha.setup('bdd')</mark>を実行</li>
        <li class="next">onload時に<mark>mocha.run()</mark>を実行</li>
        <li class="next"><mark>テストケース(test/util-spec.js)</mark>を書き直す</li>
      </ol>
    </section>

    <section class="slide center-text">
      <h3 class="">2. フレームワーク（Mocha）の導入</h3>
      <p class="f30"><span class="assert-fwn">1. CDN等でmocha.js, mocha.cssを取得</span></p>
      <p>今回は手っ取り早く<a href="https://cdnjs.com/libraries/mocha" target="_blank">CDN</a>でソースを取得します。以下のタグをindex.htmlのheadタグの最後に追記して下さい。</p>
      <mark>&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.3.0/mocha.min.css"&gt;</mark>
      <mark>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.3.0/mocha.min.js"&gt;&lt;/script&gt;</mark>
    </section>

    <section class="slide center-text">
      <h3 class="">2. フレームワーク（Mocha）の導入</h3>
      <p class="f30"><span class="assert-fwn">2. &lt;div id="mocha"&gt;&lt;/div&gt;</mark>を設置</span></p>
      <p>デモアプリのindex.htmlに以下を追記しましょう。</p>
      <pre>
      <div id="mocha"></div>
    </div>
        <code>    Result: &lt;span id="result"&gt;&lt;/span&gt;</code>
        <code><value>+   &lt;div id="mocha"&gt;&lt;/div&gt;</value></code>
        <code>  &lt;/div&gt;</code>
      </pre>
    </section>

    <section class="slide center-text">
      <h3 class="">2. フレームワーク（Mocha）の導入</h3>
      <p class="f30"><span class="assert-fwn">3. テストケースの読み込み前にmocha.setup('bdd')を実行</span></p>
      <p>デモアプリのindex.htmlに以下を追記しましょう。</p>
      <pre>
        <code><value>+   &lt;script&gt; mocha.setup('bdd') &lt;/script&gt;</value></code>
        <code>    </code>
        <code>    &lt;script src="src/util.js"&gt;&lt;/script&gt;</value></code>
        <code>    &lt;script src="src/util-spec.js"&gt;&lt;/script&gt;</value></code>
      </pre>
    </section>

    <section class="slide center-text">
      <h3 class="">2. フレームワーク（Mocha）の導入</h3>
      <p class="f30"><span class="assert-fwn">4. onload時にmocha.run()を実行</span></p>
      <p>デモアプリのapp.jsに以下を追記しましょう。</p>
      <pre>
        <code>      $('#result').text(get_message(key))</code>
        <code>    })</code>
        <code><value>+   // mochaの実行</value></code>
        <code><value>+   mocha.run()</value></code>
      </pre>
    </section>

    <section class="slide center-text">
      <h3 class="">2. フレームワーク（Mocha）の導入</h3>
      <p class="f30"><span class="assert-fwn">5. テストケース(test/util-spec.js)を書き直す</span></p>
      <p class="f30">デモアプリのutil-spec.js次のように変更しましょう。</p>
    </section>
    <section class="slide center-text">
      <pre>
        <code>  describe(<key>'valic_check関数のテスト'</key>, <value>function</value>() {</code>
        <code>     it('<key>case1: どちらも空のケース'</key>, <value>function</value>() {</code>
        <code>        <error>if</error> (auth_check() === <key>'required'</key>) {</code>
        <code>           <value>console</value>.log(<key>'OK'</key>)</code>
        <code>        } <error>else</error> {</code>
        <code>           <error>throw</error> new <value>Error</value>(<key>'NG'</key>)</code>
        <code>        }</code>
        <code>     })</code>
        <code>     （以下、同様）</code>
        <code>  })</code>
      </pre>
    </section>

    <section class="slide center-text">
      <h3 class="">2. フレームワーク（Mocha）の導入</h3>
      <br>
      <h3 class="">再度デモアプリを開いてみて下さい。（多分感動する）</h3>
    </section>

    <section class="slide center-text">
      <h2 class="shout">3. Node.jsで実行</h2>
    </section>

    <section class="slide center-text">
      <p class="shout">※ この先<span class="red">Node.js, npm<br>コマンド</span>を使います</p>
      <p class="f30 after">インストールしていない方は、<a href="https://nodejs.org/ja/" target="_blank">公式サイト</a>からインストールして下さい。npmコマンドがわからない方は<a href="https://k-kuwahara.github.io/slides/2017/workshop/npm/#">こちら</a>をご参照下さい。</p>
    </section>

    <section class="slide center-text">
      <h3 class="">3. Node.jsで実行</h3>
      <p class="f30">まだ以下の様な問題があります。</p>
      <ul>
        <li>いちいちブラウザ開くの面倒</li>
        <li>これだとCIで使えない</li>
        <li>コンソールから実行したい</li>
      </ul>
      <p class="next codicil"><span class="assert-fwn">=> Node.jsで実行すれば解決！</span></p>
    </section>

    <section class="slide center-text">
      <h3 class="">3. Node.jsで実行</h3>
      <p class="f30">導入手順は以下です。</p>
      <ol>
        <li class="next">npm initでpackage.jsonを作成</li>
        <li class="next">npmからmochaをインストール</li>
        <li class="next">テストケースの修正</li>
        <li class="next">package.jsonにtestコマンドを設定</li>
      </ol>
    </section>

    <section class="slide center-text">
      <h3 class="">3. Node.jsで実行</h3>
      <p class="f30"><span class="assert-fwn">npm initでpackage.jsonを作成</span></p>
      <p>デモアプリのapp.jsに以下を追記しましょう。</p>

    <section class="slide center-text">
      <h2 class="shout">4. karmaの導入</h2>
    </section>

    <section class="slide center-text">
      <h2 class="shout">5. テストケースのバンドル</h2>
    </section>


    <section class="slide center-text">
      <h3>次回は第二部！まずは…</h3>
      <h2 class="shout">「Node.jsの基本」</h2>
    </section>

    <section class="slide center-text">
      <h2 class="shout">お疲れ様でした！！</h2>
    </section>

    <script src="../../../shower/shower.min.js"></script>
  </body>
</html>
